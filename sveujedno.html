<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOU | Nexus Supreme v11</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <style>
        :root { --primary: #3b82f6; --accent: #00f2ff; --danger: #ef4444; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #010409; color: #f1f5f9; overflow-x: hidden; }
        .glass { background: rgba(13, 17, 23, 0.8); backdrop-filter: blur(25px); border: 1px solid rgba(255,255,255,0.05); }
        .active-tab { background: linear-gradient(90deg, rgba(59, 130, 246, 0.15) 0%, transparent 100%); border-left: 4px solid var(--primary); color: white !important; }
        input, select, textarea { background: rgba(0,0,0,0.4) !important; border: 1px solid rgba(255,255,255,0.1) !important; color: white !important; border-radius: 12px !important; outline: none; width: 100%; }
        input:focus { border-color: var(--primary) !important; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; box-shadow: 0 0 10px currentColor; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen flex flex-col md:flex-row">

    <div id="loginGate" class="fixed inset-0 z-[100] flex items-center justify-center bg-black p-4">
        <div class="glass p-8 md:p-12 rounded-[2rem] w-full max-w-md text-center animate__animated animate__zoomIn">
            <h1 class="text-2xl font-black mb-1">NEXUS <span class="text-blue-500">SUPREME</span></h1>
            <p class="text-slate-500 text-[10px] tracking-[0.5em] mb-8 uppercase">Management v11</p>
            <div class="space-y-4">
                <input type="text" id="lUser" placeholder="Username" class="p-4">
                <input type="password" id="lPass" placeholder="Password" class="p-4">
                <button onclick="auth()" class="w-full bg-blue-600 py-4 rounded-2xl font-black">CONNECT</button>
            </div>
        </div>
    </div>

    <aside id="sidebar" class="hidden w-full md:w-80 glass md:h-screen flex flex-col p-6 z-50">
        <div class="mb-10 flex items-center gap-4 p-2">
            <div id="uAvatar" class="w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center font-black text-xl">?</div>
            <div>
                <p id="uName" class="font-black text-lg leading-tight truncate w-36">User</p>
                <p id="uRoleLabel" class="text-[9px] font-bold text-blue-400 uppercase tracking-widest mt-1">Role</p>
            </div>
        </div>
        <nav class="space-y-2 flex-1 overflow-y-auto">
            <button onclick="tab('work')" class="nav-btn w-full text-left p-4 rounded-xl font-bold text-slate-400 flex items-center gap-3">‚è± Radna Ploƒça</button>
            <button onclick="tab('inventory')" class="nav-btn w-full text-left p-4 rounded-xl font-bold text-slate-400 flex items-center gap-3">üì¶ Oprema</button>
            <button onclick="tab('apply')" class="nav-btn w-full text-left p-4 rounded-xl font-bold text-slate-400 flex items-center gap-3">üìÑ Prijave</button>
            <button id="adminBtn" onclick="tab('admin')" class="hidden w-full text-left p-4 rounded-xl font-black text-red-500 bg-red-500/5 border border-red-500/20 mt-4">üõ°Ô∏è ADMIN CENTER</button>
        </nav>
        <button onclick="logout()" class="p-4 text-[10px] font-black uppercase text-slate-600">Disconnect</button>
    </aside>

    <main id="app" class="hidden flex-1 p-4 md:p-12 overflow-y-auto">
        
        <section id="s-work" class="tab-content space-y-8 animate__animated animate__fadeIn">
            <div class="glass p-12 rounded-[3.5rem] text-center border-b-8 border-blue-600">
                <div id="timer" class="text-6xl md:text-9xl font-black mb-8 italic text-white tabular-nums">00:00:00</div>
                <button id="workBtn" onclick="toggleWork()" class="w-full max-w-sm bg-white text-black py-6 rounded-2xl font-black text-2xl shadow-xl">POKRENI RAD</button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="glass p-8 rounded-[2.5rem]">
                    <h3 class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-6">Trenutno na du≈ænosti</h3>
                    <div id="activeWorkersList" class="space-y-3"></div>
                </div>
                <div class="glass p-8 rounded-[2.5rem] flex flex-col justify-center items-center">
                    <p class="text-xs font-black text-slate-500 uppercase mb-2">Ukupno sati ovaj tjedan</p>
                    <p id="myHours" class="text-6xl font-black text-blue-500">0.00h</p>
                </div>
            </div>
        </section>

        <section id="s-admin" class="tab-content hidden space-y-8 animate__animated animate__fadeIn">
            <h2 class="text-4xl font-black italic uppercase italic">Admin <span class="text-red-500">Control</span></h2>
            
            <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
                <div class="glass p-6 rounded-[2rem] border-t-4 border-blue-500">
                    <h3 class="font-black text-blue-500 mb-4 uppercase text-xs">Pristigle Prijave</h3>
                    <div id="adminAppList" class="space-y-3"></div>
                </div>

                <div class="glass p-6 rounded-[2rem] border-t-4 border-yellow-500">
                    <h3 class="font-black text-yellow-500 mb-4 uppercase text-xs">Dnevnik zadnjih radnji</h3>
                    <div id="adminWorkLog" class="space-y-2 max-h-60 overflow-y-auto text-[10px]"></div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="glass p-6 rounded-[2rem] border-l-4 border-emerald-500">
                    <h3 class="font-black text-emerald-500 mb-4 uppercase text-xs">Aktivni (Moguƒánost Kicka)</h3>
                    <div id="adminLiveControl" class="space-y-2"></div>
                </div>
                <div class="glass p-6 rounded-[2rem] border-l-4 border-red-600">
                    <h3 class="font-black text-white mb-4 uppercase text-xs">Svi Operativci</h3>
                    <div id="adminStaffList" class="space-y-2"></div>
                </div>
            </div>
        </section>

        <section id="s-apply" class="tab-content hidden animate__animated animate__fadeIn">
            <div class="glass p-8 md:p-12 rounded-[2.5rem] max-w-2xl mx-auto border-t-8 border-blue-600">
                <h2 class="text-2xl font-black mb-6 italic uppercase text-center">Prijava za posao</h2>
                <div class="space-y-4">
                    <input type="text" id="apPos" placeholder="≈Ωeljena pozicija" class="p-4">
                    <textarea id="apTxt" rows="4" placeholder="Va≈°a biografija i vje≈°tine..." class="p-4"></textarea>
                    <button onclick="sendApp()" class="w-full bg-blue-600 py-5 rounded-2xl font-black text-lg">PO≈†ALJI</button>
                </div>
            </div>
        </section>

        <section id="s-inventory" class="tab-content hidden space-y-6 animate__animated animate__fadeIn">
            <div class="glass p-6 rounded-3xl flex gap-4">
                <input type="text" id="invN" placeholder="Unesi zapis o opremi..." class="p-3">
                <button onclick="addInv()" class="bg-blue-600 px-8 rounded-xl font-black text-xs uppercase">Dodaj</button>
            </div>
            <div id="invList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4"></div>
        </section>

    </main>

    <script>
        const WH = {
            WORK: "https://discord.com/api/webhooks/1463866279860633672/CqGRQKkkBYlZkC76HqUZBaHbBuJvjmCEYkF7mZD7zrORhi7KdNA9vhBV_DRL_uTVBTZO",
            APPLY: "https://discord.com/api/webhooks/1463803834454245406/_UVJ8jv6baedZuYr25uT8S4jPgUkX_KiQtvzTgNpdDRbuHt90K-0-nvHNFURRUxzQmK6",
            EQUIP: "https://discord.com/api/webhooks/1463955268525228198/84s4OI9mWtiWY17TMqHN2VJ-GUqgzT2-vpIJsYx3-zC-lPFgGdAy73HkvvZZjdCX7nQF"
        };

        const firebaseConfig = { apiKey: "AIzaSyAoPo3Dj5yoH4sQeTScWZCe-jDDpkDPMt8", databaseURL: "https://nou-management-default-rtdb.firebaseio.com", projectId: "nou-management" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let session = { user: null, role: 'Radnik', start: null, timer: null };

        function auth() {
            const u = document.getElementById('lUser').value.trim();
            const p = document.getElementById('lPass').value.trim();
            if(u.toLowerCase() === "admin" && p === "mihatovici_79") loginSuccess("Admin", "Admin");
            else {
                db.ref('staff/' + u).once('value', s => {
                    const d = s.val();
                    if(d && d.pass === p) loginSuccess(u, d.role || "Radnik");
                    else alert("Neuspje≈°na prijava.");
                });
            }
        }

        function loginSuccess(user, role) {
            session.user = user; session.role = role;
            localStorage.setItem('nexus_user', user);
            localStorage.setItem('nexus_role', role);
            document.getElementById('loginGate').classList.add('hidden');
            document.getElementById('sidebar').classList.remove('hidden');
            document.getElementById('app').classList.remove('hidden');
            document.getElementById('uName').innerText = user;
            document.getElementById('uRoleLabel').innerText = role;
            if(role === "Admin") {
                document.getElementById('adminBtn').classList.remove('hidden');
                loadAdminData();
            }
            if(localStorage.getItem('nexus_start')) {
                session.start = parseInt(localStorage.getItem('nexus_start'));
                startTimerUI();
            }
            sync(); tab('work');
        }

        function tab(n) {
            document.querySelectorAll('.tab-content').forEach(s => s.classList.add('hidden'));
            document.getElementById('s-' + n).classList.remove('hidden');
        }

        function toggleWork() {
            if(!session.start) {
                session.start = Date.now();
                localStorage.setItem('nexus_start', session.start);
                db.ref('active_workers/' + session.user).set({ since: new Date().toLocaleTimeString('hr-HR'), startTs: session.start });
                sendDiscordEmbed(WH.WORK, "üü¢ SMJENA ZAPOƒåETA", `Operativac: **${session.user}**\nVrijeme: **${new Date().toLocaleTimeString('hr-HR')}**`, 3066993);
                startTimerUI();
            } else {
                finishSession(session.user, session.start);
            }
        }

        function startTimerUI() {
            const btn = document.getElementById('workBtn');
            btn.innerText = "ZAVR≈†I RAD"; btn.classList.replace('bg-white', 'bg-red-600'); btn.classList.add('text-white');
            session.timer = setInterval(() => {
                const diff = Date.now() - session.start;
                const h = Math.floor(diff/3600000).toString().padStart(2,'0');
                const m = Math.floor((diff%3600000)/60000).toString().padStart(2,'0');
                const s = Math.floor((diff%60000)/1000).toString().padStart(2,'0');
                document.getElementById('timer').innerText = `${h}:${m}:${s}`;
            }, 1000);
        }

        function finishSession(u, ts, isKick = false) {
            const diff = Date.now() - ts;
            const totalH = (diff / 3600000).toFixed(2);
            
            // Logiranje u povijest (za admina)
            db.ref('work_logs').push({
                user: u,
                duration: totalH,
                type: isKick ? 'KICK' : 'REGULAR',
                timestamp: new Date().toLocaleString('hr-HR')
            });

            db.ref('active_workers/' + u).remove();
            db.ref('staff/' + u).once('value', s => {
                if(s.exists()){
                    const oldH = parseFloat(s.val().hours || 0);
                    db.ref('staff/' + u).update({ hours: (oldH + parseFloat(totalH)).toFixed(2) });
                }
            });

            sendDiscordEmbed(WH.WORK, isKick ? "üö´ PRISILNA ODJAVA" : "‚èπÔ∏è SMJENA ZAVR≈†ENA", `Operativac: **${u}**\nOdraƒëeno: **${totalH}h**`, isKick ? 15158332 : 15105570);
            if(u === session.user) resetWorkUI();
        }

        function resetWorkUI() {
            clearInterval(session.timer); session.start = null; localStorage.removeItem('nexus_start');
            document.getElementById('timer').innerText = "00:00:00";
            document.getElementById('workBtn').innerText = "POKRENI RAD";
            document.getElementById('workBtn').className = "w-full max-w-sm bg-white text-black py-6 rounded-2xl font-black text-2xl shadow-xl";
        }

        function sync() {
            db.ref('active_workers').on('value', s => {
                let h = '', admH = '';
                s.forEach(w => {
                    h += `<div class="bg-white/5 p-4 rounded-xl flex items-center gap-3"><span class="status-dot text-green-500 bg-green-500"></span><span class="text-xs font-bold">${w.key}</span></div>`;
                    admH += `<div class="flex items-center justify-between p-3 bg-white/5 rounded-xl"><span class="text-xs">${w.key}</span><button onclick="finishSession('${w.key}', ${w.val().startTs}, true)" class="bg-red-600/20 text-red-500 px-3 py-1 rounded text-[10px] font-black">KICK</button></div>`;
                });
                document.getElementById('activeWorkersList').innerHTML = h || '<p class="text-slate-600 italic text-xs">Nema aktivnih.</p>';
                if(session.role === "Admin") document.getElementById('adminLiveControl').innerHTML = admH;
            });

            if(session.role === "Admin") {
                // Admin Prijave
                db.ref('applications').on('value', s => {
                    let h = '';
                    s.forEach(a => {
                        const d = a.val();
                        h += `<div class="bg-white/5 p-4 rounded-xl border border-white/5">
                            <p class="text-blue-400 font-black text-[10px] uppercase">${d.user} @ ${d.pos}</p>
                            <p class="text-[11px] text-slate-300 my-2">${d.text}</p>
                            <div class="flex gap-2">
                                <button onclick="handleApp('${a.key}', 'Prihvaƒáena', 3066993)" class="flex-1 bg-green-600 text-[10px] py-1 rounded font-black">PRIHVATI</button>
                                <button onclick="handleApp('${a.key}', 'Odbijena', 15158332)" class="flex-1 bg-red-600 text-[10px] py-1 rounded font-black">ODBIJ</button>
                            </div>
                        </div>`;
                    });
                    document.getElementById('adminAppList').innerHTML = h || '<p class="text-slate-600 italic text-xs">Nema novih prijava.</p>';
                });

                // Admin Work Log
                db.ref('work_logs').limitToLast(10).on('value', s => {
                    let h = '';
                    const logs = [];
                    s.forEach(l => logs.unshift({key: l.key, ...l.val()}));
                    logs.forEach(l => {
                        h += `<div class="p-2 border-b border-white/5 text-slate-400">
                            <span class="${l.type === 'KICK' ? 'text-red-500' : 'text-emerald-500'} font-bold">${l.user}</span> 
                            zavr≈°io rad (**${l.duration}h**) - <span class="text-[9px] opacity-50">${l.timestamp}</span>
                        </div>`;
                    });
                    document.getElementById('adminWorkLog').innerHTML = h;
                });
            }

            db.ref('staff/' + session.user).on('value', s => { document.getElementById('myHours').innerText = (s.val()?.hours || "0.00") + "h"; });
            db.ref('inventory').on('value', s => {
                let h = '';
                s.forEach(i => h += `<div class="glass p-4 rounded-xl border-l-2 border-blue-500 text-[10px] font-bold">${i.val().n}<br><span class="opacity-50 text-[8px]">Log: ${i.val().by}</span></div>`);
                document.getElementById('invList').innerHTML = h;
            });
        }

        function handleApp(id, status, color) {
            db.ref('applications/' + id).once('value', s => {
                const d = s.val();
                sendDiscordEmbed(WH.APPLY, `üìã REZULTAT PRIJAVE`, `**Korisnik:** ${d.user}\n**Pozicija:** ${d.pos}\n**Ishod:** ${status}`, color);
                db.ref('applications/' + id).remove();
            });
        }

        function sendApp() {
            const p = document.getElementById('apPos').value;
            const t = document.getElementById('apTxt').value;
            if(!p || !t) return;
            db.ref('applications').push({ user: session.user, pos: p, text: t });
            sendDiscordEmbed(WH.APPLY, "üìë NOVA PRIJAVA", `**Korisnik:** ${session.user}\n**Pozicija:** ${p}\n**Opis:** ${t}`, 3447003);
            alert("Poslano.");
            document.getElementById('apPos').value = ''; document.getElementById('apTxt').value = '';
        }

        function addInv() {
            const n = document.getElementById('invN').value;
            if(!n) return;
            db.ref('inventory').push({ n, by: session.user });
            sendDiscordEmbed(WH.EQUIP, "üì¶ LOG OPREME", `**Zapisao:** ${session.user}\n**Sadr≈æaj:** ${n}`, 15844367);
            document.getElementById('invN').value = '';
        }

        function sendDiscordEmbed(url, title, desc, color) {
            fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    embeds: [{
                        title: title,
                        description: desc,
                        color: color,
                        footer: { text: "Nexus Supreme Systems" },
                        timestamp: new Date().toISOString()
                    }]
                })
            });
        }

        function loadAdminData() {
            db.ref('staff').on('value', s => {
                let h = '';
                s.forEach(u => {
                    h += `<div class="flex justify-between p-2 bg-white/5 rounded text-[10px] border border-white/5"><span><b>${u.key}</b> (${u.val().hours}h)</span><button onclick="if(confirm('Obri≈°i?')) db.ref('staff/${u.key}').remove()" class="text-red-500 font-black">X</button></div>`;
                });
                document.getElementById('adminStaffList').innerHTML = h;
            });
        }

        function logout() { localStorage.clear(); location.reload(); }
    </script>
</body>
</html>