<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOU Ultimate Management | v5.0</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --discord-blurple: #5865F2;
            --discord-dark: #313338;
            --discord-darker: #2b2d31;
            --discord-black: #1e1f22;
            --text-white: #f2f3f5;
            --success: #23a559;
            --danger: #f23f42;
            --warning: #f0b232;
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--discord-black);
            color: var(--text-white);
            min-height: 100vh;
        }

        .glass-card { 
            background: var(--discord-dark); 
            border: 1px solid rgba(255,255,255,0.08);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border-radius: 16px;
        }

        .nav-btn {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid transparent;
        }

        .nav-btn.active {
            background: var(--discord-blurple);
            box-shadow: 0 0 15px rgba(88, 101, 242, 0.4);
            transform: translateY(-2px);
        }

        input, select, textarea {
            background-color: #111214 !important;
            border: 1px solid #3f4147 !important;
            transition: border 0.2s;
            color: white !important;
        }

        input:focus { border-color: var(--discord-blurple) !important; outline: none; }

        .strike-dot { height: 12px; width: 12px; border-radius: 50%; display: inline-block; background: #444; margin-right: 4px; }
        .strike-active { background: var(--danger); box-shadow: 0 0 10px var(--danger); }

        .tab-content { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        #chatBox::-webkit-scrollbar { width: 4px; }
        #chatBox::-webkit-scrollbar-thumb { background: #444; border-radius: 10px; }
    </style>
</head>
<body class="p-4 md:p-8">

<div class="max-w-5xl mx-auto">
    <header class="text-center mb-8">
        <h1 class="text-5xl font-extrabold tracking-tighter mb-1 uppercase italic">NOU <span class="text-[#5865F2]">Management</span></h1>
        <p class="text-gray-500 font-bold text-xs tracking-widest uppercase">Centralni IT sustav v5.0</p>
    </header>

    <div class="glass-card p-5 mb-6 flex flex-col md:flex-row items-center gap-6 border-l-4 border-[#5865F2]">
        <div class="flex-1 w-full text-center md:text-left">
            <label class="text-[10px] uppercase font-black text-gray-500 tracking-widest">Prijavljeni Korisnik</label>
            <input type="text" id="globalUser" placeholder="Upi≈°i Discord ID (npr. Eldo#0001)" oninput="syncUser()" 
                   class="w-full mt-1 p-3 rounded-lg font-bold text-lg tracking-tight">
        </div>
        <div id="userStats" class="hidden flex items-center gap-8 bg-black/40 p-4 rounded-xl border border-white/5 shadow-inner">
            <div class="text-center">
                <p class="text-[9px] text-gray-500 uppercase font-black mb-1">Status Rada</p>
                <p id="statHours" class="text-xl font-black text-blue-400 leading-none">0.00h</p>
            </div>
            <div class="text-center border-l border-white/10 pl-8">
                <p class="text-[9px] text-gray-500 uppercase font-black mb-1">Opomene (Strikes)</p>
                <div id="statStrikes" class="flex mt-1 justify-center"></div>
            </div>
        </div>
    </div>

    <nav class="flex gap-2 overflow-x-auto pb-4 mb-6">
        <button class="nav-btn active px-6 py-3 rounded-xl font-black text-xs uppercase" onclick="showTab('work')">‚è± Rad</button>
        <button class="nav-btn px-6 py-3 rounded-xl font-black text-xs uppercase" onclick="showTab('chat')">üí¨ Chat</button>
        <button class="nav-btn px-6 py-3 rounded-xl font-black text-xs uppercase" onclick="showTab('inventory')">üì¶ Oprema</button>
        <button class="nav-btn px-6 py-3 rounded-xl font-black text-xs uppercase" onclick="showTab('apply')">üìù Prijava</button>
        <button class="nav-btn px-6 py-3 rounded-xl font-black text-xs uppercase text-yellow-500 border-yellow-500/20" onclick="showTab('admin')">üîí Admin Panel</button>
    </nav>

    <main>
        <section id="workTab" class="tab-content space-y-6">
            <div class="glass-card p-10 text-center relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-[#5865F2] to-transparent"></div>
                <h3 class="text-3xl font-black mb-8 tracking-tight">Sustav Evidencije Sati</h3>
                <div class="flex flex-col md:flex-row gap-4 max-w-2xl mx-auto">
                    <button onclick="clockIn()" class="flex-1 bg-green-600 hover:bg-green-500 py-5 rounded-2xl font-black text-lg transition-all shadow-lg shadow-green-900/20 active:scale-95">START SMJENA</button>
                    <button onclick="clockOut()" class="flex-1 bg-red-600 hover:bg-red-500 py-5 rounded-2xl font-black text-lg transition-all shadow-lg shadow-red-900/20 active:scale-95">STOP SMJENA</button>
                </div>
                <p id="workStatus" class="mt-6 text-gray-500 font-bold uppercase text-xs tracking-widest tracking-tighter">Status: Offline</p>
            </div>

            <div class="glass-card p-6">
                <h3 class="font-black text-blue-400 uppercase text-[10px] tracking-widest mb-6 border-b border-white/5 pb-2">Aktivnost u stvarnom vremenu</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-left">
                        <tbody id="activeBody" class="divide-y divide-white/5"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <section id="chatTab" class="tab-content hidden">
            <div class="glass-card p-5 h-[600px] flex flex-col">
                <div id="chatBox" class="flex-1 overflow-y-auto space-y-4 p-2 pr-4"></div>
                <div class="mt-4 flex gap-3 bg-black/40 p-3 rounded-2xl">
                    <input type="text" id="chatInput" placeholder="Napi≈°i poruku timu..." class="flex-1 p-3 rounded-xl border-none text-sm" onkeypress="if(event.key==='Enter') sendChat()">
                    <button onclick="sendChat()" class="bg-[#5865F2] hover:bg-[#4752c4] px-8 rounded-xl font-black transition-all">≈†ALJI</button>
                </div>
            </div>
        </section>

        <section id="inventoryTab" class="tab-content hidden space-y-4">
            <div class="glass-card p-6">
                <h3 class="font-black text-xs uppercase text-gray-400 mb-4">Novi Inventarni Broj</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <input type="text" id="invNaziv" placeholder="Naziv ureƒëaja" class="p-3 rounded-lg text-sm font-bold">
                    <input type="text" id="invModel" placeholder="Proizvoƒëaƒç/Model" class="p-3 rounded-lg text-sm">
                    <select id="invKat" class="p-3 rounded-lg text-sm font-bold uppercase">
                        <option>Laptop</option><option>Monitor</option><option>Server</option><option>Telefon</option><option>Ostalo</option>
                    </select>
                    <input type="text" id="invSN" placeholder="Serijski broj / IMEI" class="p-3 rounded-lg text-sm">
                </div>
                <button onclick="addInventory()" class="w-full mt-4 bg-blue-600 hover:bg-blue-500 py-3 rounded-xl font-black uppercase text-xs tracking-widest transition-all">Spremi u bazu podataka</button>
            </div>
            <div id="invList" class="grid grid-cols-1 md:grid-cols-3 gap-4 pb-12"></div>
        </section>

        <section id="applyTab" class="tab-content hidden">
            <div class="glass-card p-10 max-w-2xl mx-auto border-t-4 border-green-500">
                <h2 class="text-3xl font-black mb-2 uppercase italic leading-none">Prijavi se</h2>
                <p class="text-gray-500 text-sm mb-8">Postani dio NOU operativnog tima.</p>
                
                <label class="text-[10px] font-black text-gray-500 uppercase tracking-widest">≈Ωeljena rola</label>
                <select id="applyRole" class="w-full mt-1 mb-6 p-4 rounded-xl font-bold">
                    <option value="Helper">üõ°Ô∏è Admin Helper</option>
                    <option value="Designer">üé® Creative Designer</option>
                    <option value="Worker">üõ†Ô∏è System Worker</option>
                </select>

                <label class="text-[10px] font-black text-gray-500 uppercase tracking-widest">Razlog prijave i iskustvo</label>
                <textarea id="applyReason" rows="5" class="w-full mt-1 mb-6 p-4 rounded-xl" placeholder="≈†to te izdvaja od drugih?"></textarea>
                
                <button onclick="submitApplication()" class="w-full bg-[#5865F2] hover:bg-[#4752c4] py-5 rounded-2xl font-black text-lg transition-all uppercase shadow-lg shadow-blue-900/30">Po≈°alji prijavu</button>
            </div>
        </section>

        <section id="adminTab" class="tab-content hidden">
            <div id="adminAuth" class="glass-card p-12 text-center max-w-sm mx-auto">
                <div class="bg-yellow-500/10 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 border border-yellow-500/20">
                    <span class="text-3xl">üîê</span>
                </div>
                <h2 class="text-2xl font-black mb-2 uppercase tracking-tight">Restricted</h2>
                <p class="text-gray-500 text-xs mb-8 uppercase tracking-widest">Samo za upravu</p>
                <input type="password" id="adminPass" placeholder="Admin Lozinka" class="w-full p-4 rounded-xl mb-4 text-center text-lg font-black tracking-widest">
                <button onclick="checkAdmin()" class="w-full bg-white text-black py-4 rounded-xl font-black hover:bg-gray-200 transition-all">OTKLJUƒåAJ KONZOLU</button>
            </div>

            <div id="adminPanel" class="hidden space-y-6">
                <div class="glass-card p-6 border-l-4 border-yellow-500">
                    <h3 class="text-yellow-500 font-black uppercase text-xs tracking-widest mb-4">Slanje Slu≈æbenih Obavijesti (Discord Embed)</h3>
                    <div class="space-y-4">
                        <input type="text" id="annTitle" placeholder="Naslov obavijesti (npr. VA≈ΩAN SASTANAK)" class="w-full p-3 rounded-lg font-black">
                        <textarea id="annMsg" rows="3" placeholder="Glavni tekst obavijesti..." class="w-full p-3 rounded-lg"></textarea>
                        <input type="text" id="annImg" placeholder="Link slike (URL - npr. https://stranica.com/slika.jpg)" class="w-full p-3 rounded-lg text-sm">
                        <div class="grid grid-cols-2 gap-4">
                            <button onclick="sendOfficial('ann')" class="bg-yellow-600 hover:bg-yellow-500 py-3 rounded-xl font-black text-xs uppercase tracking-tighter shadow-lg shadow-yellow-900/20">≈†alji kao Obavijest</button>
                            <button onclick="sendOfficial('alert')" class="bg-red-600 hover:bg-red-500 py-3 rounded-xl font-black text-xs uppercase tracking-tighter shadow-lg shadow-red-900/20">≈†alji kao HITNO (Alert)</button>
                        </div>
                    </div>
                </div>

                <div class="glass-card p-6 border-l-4 border-red-600">
                    <h3 class="text-red-500 font-black uppercase text-xs tracking-widest mb-4">Database Wipe (OPREZNO)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button onclick="wipeData('chat')" class="p-3 bg-red-900/10 border border-red-600/30 text-red-500 rounded-xl text-[10px] font-black hover:bg-red-600 hover:text-white transition-all">OƒåISTI CHAT</button>
                        <button onclick="wipeData('users')" class="p-3 bg-red-900/10 border border-red-600/30 text-red-500 rounded-xl text-[10px] font-black hover:bg-red-600 hover:text-white transition-all">OBRI≈†I RADNIKE</button>
                        <button onclick="wipeData('inventar')" class="p-3 bg-red-900/10 border border-red-600/30 text-red-500 rounded-xl text-[10px] font-black hover:bg-red-600 hover:text-white transition-all">OƒåISTI INVENTAR</button>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 pb-12">
                    <div class="glass-card p-6">
                        <h3 class="text-blue-400 font-black uppercase text-xs tracking-widest mb-4">Strike Manager</h3>
                        <input type="text" id="strikeTarget" placeholder="Ime#0000" class="w-full p-3 rounded-lg mb-3">
                        <div class="grid grid-cols-3 gap-2 mb-3">
                            <button onclick="setStrike(1)" class="bg-red-600/20 text-red-500 border border-red-500/20 py-2 rounded-lg font-black text-xs">S1</button>
                            <button onclick="setStrike(2)" class="bg-red-600/40 text-red-400 border border-red-500/20 py-2 rounded-lg font-black text-xs">S2</button>
                            <button onclick="setStrike(3)" class="bg-red-600 text-white py-2 rounded-lg font-black text-xs">S3</button>
                        </div>
                        <button onclick="resetStrike()" class="w-full bg-gray-700 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest">Resetiraj Strikes</button>
                    </div>

                    <div class="glass-card p-6">
                        <h3 class="text-gray-400 font-black uppercase text-xs tracking-widest mb-4">Worker List</h3>
                        <div class="overflow-y-auto max-h-48">
                             <table class="w-full text-xs">
                                <tbody id="fullAdminBody" class="divide-y divide-white/5"></tbody>
                             </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
</div>

<script>
    // --- FIREBASE KONFIGURACIJA ---
    const firebaseConfig = {
        apiKey: "AIzaSyAoPo3Dj5yoH4sQeTScWZCe-jDDpkDPMt8",
        authDomain: "nou-management.firebaseapp.com",
        databaseURL: "https://nou-management-default-rtdb.firebaseio.com",
        projectId: "nou-management",
        storageBucket: "nou-management.firebasestorage.app",
        messagingSenderId: "1098791447574",
        appId: "1:1098791447574:web:6e4c666d302055658c9937"
    };

    const WEBHOOK = "https://discord.com/api/webhooks/1463866279860633672/CqGRQKkkBYlZkC76HqUZBaHbBuJvjmCEYkF7mZD7zrORhi7KdNA9vhBV_DRL_uTVBTZO";
    const ADMIN_PW = "mihatovici_79";

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const getU = () => document.getElementById('globalUser').value.trim();
    const sanitize = (n) => n.replace(/[.#$/[\]]/g, '_');

    // --- NAVIGACIJA ---
    function showTab(id) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id + 'Tab').classList.remove('hidden');
        event.currentTarget.classList.add('active');
    }

    // --- KORISNIK ---
    function syncUser() {
        const u = getU();
        const statDiv = document.getElementById('userStats');
        if(!u) { statDiv.classList.add('hidden'); return; }
        db.ref('users/' + sanitize(u)).on('value', s => {
            const d = s.val();
            if(d) {
                statDiv.classList.remove('hidden');
                document.getElementById('statHours').innerText = `${d.hours || '0.00'}h`;
                let dots = '';
                for(let i=1; i<=3; i++) dots += `<span class="strike-dot ${i <= (d.strikes || 0) ? 'strike-active' : ''}"></span>`;
                document.getElementById('statStrikes').innerHTML = dots;
            }
        });
    }

    // --- RAD ---
    function clockIn() {
        if(!getU()) return alert("Unesi Discord ID!");
        db.ref('users/' + sanitize(getU())).update({ status: 'Online', lastIn: Date.now() });
        postDiscord(`üöÄ **${getU()}** je zapoƒçeo svoju smjenu!`);
        document.getElementById('workStatus').innerText = "Status: NA DU≈ΩNOSTI (ONLINE)";
    }

    function clockOut() {
        if(!getU()) return;
        const id = sanitize(getU());
        db.ref('users/' + id).once('value', s => {
            const d = s.val();
            if(!d || !d.lastIn) return alert("Nisi prijavljen u rad!");
            const diff = ((Date.now() - d.lastIn) / 3600000).toFixed(2);
            const total = (parseFloat(d.hours || 0) + parseFloat(diff)).toFixed(2);
            db.ref('users/' + id).update({ status: 'Offline', hours: total, lastIn: null });
            postDiscord(`‚èπ **${getU()}** je zavr≈°io rad. Radio: **${diff}h**. Ukupno: **${total}h**.`);
            document.getElementById('workStatus').innerText = "Status: Offline";
        });
    }

    // --- CHAT ---
    function sendChat() {
        const t = document.getElementById('chatInput').value;
        if(!t || !getU()) return;
        db.ref('chat').push({ u: getU(), t: t, time: Date.now() });
        document.getElementById('chatInput').value = "";
    }

    db.ref('chat').limitToLast(25).on('value', s => {
        let h = '';
        s.forEach(c => {
            const m = c.val();
            h += `<div class="bg-black/30 p-4 rounded-2xl border-l-4 border-[#5865F2] shadow-sm">
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-[9px] font-black text-blue-400 uppercase tracking-widest">${m.u}</span>
                    </div>
                    <p class="text-sm text-gray-200">${m.t}</p>
                  </div>`;
        });
        const b = document.getElementById('chatBox');
        b.innerHTML = h; b.scrollTop = b.scrollHeight;
    });

    // --- INVENTAR ---
    function addInventory() {
        const n = document.getElementById('invNaziv').value;
        if(!n) return;
        db.ref('inventar').push({
            naziv: n, model: document.getElementById('invModel').value,
            kat: document.getElementById('invKat').value, sn: document.getElementById('invSN').value
        });
        alert("Dodano!");
    }

    db.ref('inventar').on('value', s => {
        let h = '';
        s.forEach(c => {
            const i = c.val();
            h += `<div class="glass-card p-5 border-t-2 border-blue-500/50">
                    <h4 class="font-black text-md leading-tight">${i.naziv}</h4>
                    <p class="text-xs text-gray-500 mb-3">${i.model}</p>
                    <div class="bg-black/40 p-2 rounded text-[9px] font-black text-blue-400 uppercase">SN: ${i.sn || 'Nema'} | ${i.kat}</div>
                  </div>`;
        });
        document.getElementById('invList').innerHTML = h;
    });

    // --- ADMIN PANEL SLANJE (OBAVIJESTI I SLIKE) ---
    function sendOfficial(type) {
        const title = document.getElementById('annTitle').value;
        const msg = document.getElementById('annMsg').value;
        const img = document.getElementById('annImg').value;

        if(!title || !msg) return alert("Naslov i poruka su obavezni!");

        const embedData = {
            embeds: [{
                title: (type === 'alert' ? "üö® HITNA OBAVIJEST: " : "üì¢ OBAVIJEST: ") + title,
                description: msg,
                color: type === 'alert' ? 15206400 : 16763904,
                image: img ? { url: img } : null,
                footer: { text: "Poslano putem NOU Management Konzole" },
                timestamp: new Date()
            }]
        };

        fetch(WEBHOOK, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(embedData) })
        .then(() => {
            alert("Uspje≈°no poslano!");
            document.getElementById('annTitle').value = "";
            document.getElementById('annMsg').value = "";
            document.getElementById('annImg').value = "";
        });
    }

    // --- OSTALE ADMIN FUNKCIJE ---
    function checkAdmin() {
        if(document.getElementById('adminPass').value === ADMIN_PW) {
            document.getElementById('adminAuth').classList.add('hidden');
            document.getElementById('adminPanel').classList.remove('hidden');
            loadAdminData();
        } else alert("Netoƒçna lozinka!");
    }

    function setStrike(n) {
        const t = document.getElementById('strikeTarget').value.trim();
        if(!t) return;
        db.ref('users/' + sanitize(t)).update({ strikes: n });
        postDiscord(`‚ö†Ô∏è **STRIKE ${n}/3** dodijeljen radniku **${t}**!`);
    }

    function resetStrike() {
        const t = document.getElementById('strikeTarget').value.trim();
        if(!t) return;
        db.ref('users/' + sanitize(t)).update({ strikes: 0 });
    }

    function wipeData(path) {
        if(confirm("PA≈ΩNJA: Trajno bri≈°e≈° sve podatke iz " + path + ". Nastaviti?")) db.ref(path).remove();
    }

    function loadAdminData() {
        db.ref('users').on('value', s => {
            let h = '';
            s.forEach(c => {
                const u = c.val();
                h += `<tr class="border-b border-white/5"><td class="py-2 font-bold">${c.key}</td><td class="text-blue-400 font-black">${u.hours || 0}h</td><td class="text-right"><button onclick="deleteUser('${c.key}')" class="text-red-500 font-black uppercase text-[9px]">Izbaci</button></td></tr>`;
            });
            document.getElementById('fullAdminBody').innerHTML = h;
        });
    }

    function deleteUser(id) { if(confirm("Obrisati radnika?")) db.ref('users/'+id).remove(); }

    function postDiscord(msg) { fetch(WEBHOOK, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({content: msg}) }); }

    function submitApplication() {
        if(!getU()) return alert("Ime!");
        const data = {
            embeds: [{
                title: "üì© Nova Prijava za NOU Operativca",
                color: 5814783,
                fields: [
                    { name: "üë§ Kandidat", value: getU(), inline: true },
                    { name: "üé≠ Pozicija", value: document.getElementById('applyRole').value, inline: true },
                    { name: "üìù Motivacija", value: document.getElementById('applyReason').value }
                ],
                footer: { text: "NOU Recruitment Sustav" },
                timestamp: new Date()
            }]
        };
        fetch(WEBHOOK, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data) }).then(() => alert("Prijava poslana!"));
    }

    // LIVE UPDATE
    db.ref('users').on('value', s => {
        let h = '';
        s.forEach(c => {
            const u = c.val();
            let dots = '';
            for(let i=1; i<=3; i++) dots += `<span class="strike-dot ${i <= (u.strikes || 0) ? 'strike-active' : ''}"></span>`;
            h += `<tr><td class="py-4 font-black tracking-tighter text-lg">${c.key}</td><td><span class="${u.status === 'Online' ? 'text-green-500' : 'text-gray-600'} font-black text-[10px] uppercase">${u.status || 'Offline'}</span></td><td class="text-right">${dots}</td></tr>`;
        });
        document.getElementById('activeBody').innerHTML = h;
    });

</script>
</body>
</html>
