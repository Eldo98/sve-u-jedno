<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOU | Nexus Supreme v11</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <style>
        :root { --primary: #3b82f6; --accent: #00f2ff; --danger: #ef4444; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #010409; color: #f1f5f9; overflow-x: hidden; }
        
        .glass { background: rgba(13, 17, 23, 0.8); backdrop-filter: blur(25px); border: 1px solid rgba(255,255,255,0.05); }
        .neon-glow { box-shadow: 0 0 25px rgba(59, 130, 246, 0.2); }
        .active-tab { background: linear-gradient(90deg, rgba(59, 130, 246, 0.15) 0%, transparent 100%); border-left: 4px solid var(--primary); color: white !important; }
        
        input, select, textarea { background: rgba(0,0,0,0.4) !important; border: 1px solid rgba(255,255,255,0.1) !important; color: white !important; border-radius: 12px !important; outline: none; width: 100%; }
        input:focus, textarea:focus { border-color: var(--primary) !important; box-shadow: 0 0 10px rgba(59, 130, 246, 0.2); }
        
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; box-shadow: 0 0 10px currentColor; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #1e293b; border-radius: 10px; }

        /* Mobile Optimization */
        @media (max-width: 768px) {
            .nav-btn { padding: 10px; font-size: 14px; }
            #timer { font-size: 4rem !important; }
            .glass { padding: 1.5rem !important; border-radius: 1.5rem !important; }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col md:flex-row">

    <div id="loginGate" class="fixed inset-0 z-[100] flex items-center justify-center bg-black p-4">
        <div class="glass p-8 md:p-12 rounded-[2rem] md:rounded-[3rem] w-full max-w-md text-center animate__animated animate__zoomIn">
            <img src="1000008121.jpg" class="w-20 h-20 md:w-24 md:h-24 rounded-3xl mx-auto mb-6 border border-white/10 shadow-2xl">
            <h1 class="text-2xl md:text-3xl font-black mb-1">NEXUS <span class="text-blue-500">SUPREME</span></h1>
            <p class="text-slate-500 text-[10px] tracking-[0.5em] mb-8 md:mb-10 uppercase">Security Protocol v11</p>
            <div class="space-y-4">
                <input type="text" id="lUser" placeholder="Username" class="p-4">
                <input type="password" id="lPass" placeholder="Password" class="p-4">
                <button onclick="auth()" class="w-full bg-blue-600 hover:bg-blue-500 py-4 rounded-2xl font-black transition-all">CONNECT</button>
            </div>
        </div>
    </div>

    <aside id="sidebar" class="hidden w-full md:w-80 glass md:h-screen flex flex-col p-6 md:p-8 z-50">
        <div class="mb-6 md:mb-10 flex items-center gap-4 p-2">
            <div id="uAvatar" class="w-12 h-12 bg-blue-600 rounded-xl flex items-center justify-center font-black text-xl">?</div>
            <div>
                <p id="uName" class="font-black text-lg leading-tight truncate w-36">User</p>
                <p id="uRoleLabel" class="text-[9px] font-bold text-blue-400 uppercase tracking-widest mt-1">Role</p>
            </div>
        </div>
        <nav class="space-y-2 flex-1 overflow-y-auto">
            <button onclick="tab('work')" class="nav-btn w-full text-left p-4 rounded-xl font-bold text-slate-400 flex items-center gap-3">‚è± Radna Ploƒça</button>
            <button onclick="tab('inventory')" class="nav-btn w-full text-left p-4 rounded-xl font-bold text-slate-400 flex items-center gap-3">üì¶ Oprema</button>
            <button onclick="tab('apply')" class="nav-btn w-full text-left p-4 rounded-xl font-bold text-slate-400 flex items-center gap-3">üìÑ Prijave</button>
            <button onclick="tab('info')" class="nav-btn w-full text-left p-4 rounded-xl font-bold text-slate-400 flex items-center gap-3">üì¢ Obavijesti</button>
            <button id="adminBtn" onclick="tab('admin')" class="hidden w-full text-left p-4 rounded-xl font-black text-red-500 bg-red-500/5 border border-red-500/20 mt-4">üõ°Ô∏è ADMIN CENTER</button>
        </nav>
        <button onclick="logout()" class="p-4 text-[10px] font-black uppercase text-slate-600 hover:text-red-500 transition-colors">Disconnect</button>
    </aside>

    <main id="app" class="hidden flex-1 p-4 md:p-12 overflow-y-auto">
        
        <section id="s-work" class="tab-content space-y-6 md:y-8 animate__animated animate__fadeIn">
            <div class="glass p-8 md:p-12 rounded-[2rem] md:rounded-[3.5rem] text-center border-b-8 border-blue-600 relative overflow-hidden">
                <div id="timer" class="text-6xl md:text-9xl font-black mb-8 italic tracking-tighter text-white tabular-nums">00:00:00</div>
                <button id="workBtn" onclick="toggleWork()" class="w-full max-w-sm bg-white text-black py-5 md:py-6 rounded-2xl font-black text-xl md:text-2xl hover:scale-105 transition-all shadow-xl">POKRENI RAD</button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="glass p-6 md:p-8 rounded-[2rem]">
                    <h3 class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-6">Online Operativci</h3>
                    <div id="activeWorkersList" class="space-y-3"></div>
                </div>
                <div class="glass p-6 md:p-8 rounded-[2rem] flex flex-col justify-center items-center">
                    <p class="text-[10px] font-black text-slate-500 uppercase mb-2">Moji Sati</p>
                    <p id="myHours" class="text-5xl md:text-6xl font-black text-blue-500">0.00h</p>
                </div>
            </div>
        </section>

        <section id="s-admin" class="tab-content hidden space-y-8 animate__animated animate__fadeIn">
            <h2 class="text-4xl font-black italic uppercase">Admin <span class="text-red-500">Console</span></h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="glass p-8 rounded-[2.5rem] border-t-4 border-emerald-500">
                    <h3 class="font-black text-emerald-500 mb-6 uppercase text-xs">Live Nadzor i Kick</h3>
                    <div id="adminLiveControl" class="space-y-3"></div>
                </div>
                <div class="glass p-8 rounded-[2.5rem] border-t-4 border-red-600">
                    <h3 class="font-black text-white mb-6 uppercase text-xs">Upravljanje Staffom</h3>
                    <div class="space-y-3 mb-6">
                        <input type="text" id="adU" placeholder="Ime" class="p-3">
                        <input type="text" id="adP" placeholder="≈†ifra" class="p-3">
                        <button onclick="createStaff()" class="w-full bg-red-600 py-3 rounded-xl font-black">DODAJ</button>
                    </div>
                    <div id="adminStaffList" class="space-y-2 max-h-40 overflow-y-auto"></div>
                </div>
            </div>
            <div class="glass p-8 rounded-[2.5rem] border-l-8 border-blue-500">
                <h3 class="font-black text-blue-500 mb-6 uppercase text-xs">Globalni Info Editor</h3>
                <textarea id="infoEditor" class="p-4 h-32 mb-4" placeholder="Unesite obavijest..."></textarea>
                <div class="flex flex-col md:flex-row gap-4">
                    <button onclick="saveInfo()" class="flex-1 bg-blue-600 py-4 rounded-xl font-black">OBJAVI</button>
                    <button onclick="deleteInfo()" class="bg-red-600/20 text-red-500 px-8 py-4 rounded-xl font-black border border-red-500/20">OBRI≈†I</button>
                </div>
            </div>
        </section>

        <section id="s-inventory" class="tab-content hidden space-y-6 animate__animated animate__fadeIn">
            <div class="glass p-6 rounded-3xl flex flex-col md:flex-row gap-4">
                <input type="text" id="invN" placeholder="Naziv predmeta/opreme" class="p-3">
                <button onclick="addInv()" class="bg-blue-600 py-3 md:px-10 rounded-xl font-black uppercase text-xs">Dodaj log</button>
            </div>
            <div id="invList" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
        </section>

        <section id="s-info" class="tab-content hidden animate__animated animate__fadeIn">
            <div id="infoView" class="glass p-8 md:p-16 rounded-[2rem] md:rounded-[4rem] text-xl md:text-2xl italic text-slate-300 border-l-[12px] border-blue-600 shadow-2xl">
                Uƒçitavanje...
            </div>
        </section>

        <section id="s-apply" class="tab-content hidden animate__animated animate__fadeIn">
            <div class="glass p-8 md:p-12 rounded-[2.5rem] md:rounded-[3.5rem] max-w-2xl mx-auto border-t-8 border-blue-600">
                <h2 class="text-2xl md:text-3xl font-black mb-8 italic uppercase text-center">Prijava za posao</h2>
                <div class="space-y-4">
                    <input type="text" id="apPos" placeholder="Pozicija" class="p-4">
                    <textarea id="apTxt" rows="4" placeholder="Za≈°to ba≈° ti?" class="p-4"></textarea>
                    <button onclick="sendApp()" class="w-full bg-blue-600 py-5 rounded-2xl font-black text-lg">PO≈†ALJI</button>
                </div>
            </div>
        </section>
    </main>

    <script>
        const WH = {
            WORK: "https://discord.com/api/webhooks/1463866279860633672/CqGRQKkkBYlZkC76HqUZBaHbBuJvjmCEYkF7mZD7zrORhi7KdNA9vhBV_DRL_uTVBTZO",
            INFO: "https://discord.com/api/webhooks/1463869887498817536/gRHBl-FjoQ0hFZhJ3k6qbAkk4adLI-EAPuO94ncVd-8tSd-6LW8AOsxOGnfwJIYVlNNR",
            APPLY: "https://discord.com/api/webhooks/1463803834454245406/_UVJ8jv6baedZuYr25uT8S4jPgUkX_KiQtvzTgNpdDRbuHt90K-0-nvHNFURRUxzQmK6",
            EQUIP: "https://discord.com/api/webhooks/1463955268525228198/84s4OI9mWtiWY17TMqHN2VJ-GUqgzT2-vpIJsYx3-zC-lPFgGdAy73HkvvZZjdCX7nQF"
        };

        const firebaseConfig = { apiKey: "AIzaSyAoPo3Dj5yoH4sQeTScWZCe-jDDpkDPMt8", databaseURL: "https://nou-management-default-rtdb.firebaseio.com", projectId: "nou-management" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let session = { user: null, role: 'Radnik', start: null, timer: null };

        // --- PERSISTENCE LOGIC ---
        window.onload = () => {
            const savedUser = localStorage.getItem('nexus_user');
            const savedRole = localStorage.getItem('nexus_role');
            const savedStart = localStorage.getItem('nexus_start');

            if(savedUser && savedRole) {
                if(savedStart) session.start = parseInt(savedStart);
                loginSuccess(savedUser, savedRole, true);
            }
        };

        function auth() {
            const u = document.getElementById('lUser').value.trim();
            const p = document.getElementById('lPass').value.trim();
            if(u.toLowerCase() === "admin" && p === "mihatovici_79") {
                loginSuccess("Admin", "Admin");
            } else {
                db.ref('staff/' + u).once('value', s => {
                    const d = s.val();
                    if(d && d.pass === p) loginSuccess(u, d.role || "Radnik");
                    else alert("Pristup odbijen.");
                });
            }
        }

        function loginSuccess(user, role, isAuto = false) {
            session.user = user; session.role = role;
            localStorage.setItem('nexus_user', user);
            localStorage.setItem('nexus_role', role);

            document.getElementById('loginGate').classList.add('hidden');
            document.getElementById('sidebar').classList.remove('hidden');
            document.getElementById('app').classList.remove('hidden');
            document.getElementById('uName').innerText = user;
            document.getElementById('uRoleLabel').innerText = role;
            document.getElementById('uAvatar').innerText = user[0].toUpperCase();
            
            if(role === "Admin" || user.toLowerCase() === "admin") {
                document.getElementById('adminBtn').classList.remove('hidden');
                loadAdminData();
            }

            if(session.start) {
                startTimerUI();
            }

            sync(); tab('work'); listenForKick();
        }

        function logout() {
            localStorage.clear();
            location.reload();
        }

        function tab(n) {
            document.querySelectorAll('.tab-content').forEach(s => s.classList.add('hidden'));
            document.getElementById('s-' + n).classList.remove('hidden');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active-tab'));
            const b = Array.from(document.querySelectorAll('.nav-btn')).find(x => x.innerText.toLowerCase().includes(n === 'work' ? 'ploƒça' : n));
            if(b) b.classList.add('active-tab');
        }

        function toggleWork() {
            if(!session.start) {
                const now = new Date();
                session.start = Date.now();
                localStorage.setItem('nexus_start', session.start);
                
                db.ref('active_workers/' + session.user).set({ 
                    since: now.toLocaleTimeString('hr-HR'), 
                    startTs: session.start 
                });
                
                sendDiscord(WH.WORK, `üü¢ **${session.user}** je na du≈ænosti od **${now.toLocaleTimeString('hr-HR')}**`);
                startTimerUI();
            } else {
                finishSession(session.user, session.start);
                resetWorkUI();
            }
        }

        function startTimerUI() {
            const btn = document.getElementById('workBtn');
            btn.innerText = "ZAVR≈†I RAD"; 
            btn.classList.replace('bg-white', 'bg-red-600'); 
            btn.classList.add('text-white');

            if(session.timer) clearInterval(session.timer);
            session.timer = setInterval(() => {
                const diff = Date.now() - session.start;
                const h = Math.floor(diff/3600000).toString().padStart(2,'0');
                const m = Math.floor((diff%3600000)/60000).toString().padStart(2,'0');
                const s = Math.floor((diff%60000)/1000).toString().padStart(2,'0');
                document.getElementById('timer').innerText = `${h}:${m}:${s}`;
            }, 1000);
        }

        function finishSession(u, ts, isKick = false) {
            const diff = Date.now() - ts;
            const mins = (diff / 60000).toFixed(0);
            const totalH = (diff / 3600000).toFixed(2);
            
            db.ref('active_workers/' + u).remove();
            db.ref('staff/' + u).once('value', s => {
                if(s.exists()){
                    const oldH = parseFloat(s.val().hours || 0);
                    db.ref('staff/' + u).update({ hours: (oldH + parseFloat(totalH)).toFixed(2) });
                }
            });
            
            sendDiscord(WH.WORK, `${isKick ? 'üö´ **KICK**' : '‚èπÔ∏è **KRAJ**'} | **${u}** | Trajanje: **${mins} min** | Ukupno: **${totalH} h**`);
            if(u === session.user) resetWorkUI();
        }

        function resetWorkUI() {
            clearInterval(session.timer);
            session.start = null;
            localStorage.removeItem('nexus_start');
            document.getElementById('timer').innerText = "00:00:00";
            document.getElementById('workBtn').innerText = "POKRENI RAD";
            document.getElementById('workBtn').className = "w-full max-w-sm bg-white text-black py-6 rounded-2xl font-black text-2xl hover:scale-105 transition-all shadow-xl";
        }

        function listenForKick() {
            db.ref('active_workers/' + session.user).on('value', s => {
                if(session.start && !s.exists()) { 
                    resetWorkUI(); 
                    alert("Admin vas je odjavio."); 
                }
            });
        }

        // --- SYNC & DATABASE (Ostalo isto uz male popravke za mobilne) ---
        function sync() {
            db.ref('active_workers').on('value', s => {
                let h = '', admH = '';
                s.forEach(w => {
                    const d = w.val();
                    h += `<div class="bg-white/5 p-4 rounded-xl flex items-center gap-3 border border-white/5"><span class="status-dot text-green-500 bg-green-500"></span><span class="text-xs font-bold">${w.key} <span class="text-slate-500 ml-2">od ${d.since}</span></span></div>`;
                    admH += `<div class="flex items-center justify-between p-3 bg-white/5 rounded-xl border border-white/5"><span class="text-xs font-bold">${w.key}</span><button onclick="finishSession('${w.key}', ${d.startTs}, true)" class="bg-red-600/20 text-red-500 px-3 py-1 rounded-lg text-[10px] font-black">KICK</button></div>`;
                });
                document.getElementById('activeWorkersList').innerHTML = h || '<p class="text-slate-700 text-xs italic">Nema aktivnih.</p>';
                if(document.getElementById('adminLiveControl')) document.getElementById('adminLiveControl').innerHTML = admH || '<p class="text-slate-700 text-[10px] italic">Prazno.</p>';
            });

            db.ref('globalInfo').on('value', s => {
                const val = s.val() || 'Trenutno nema novih obavijesti.';
                document.getElementById('infoView').innerText = val;
                if(session.role === "Admin") document.getElementById('infoEditor').value = s.val() || '';
            });

            db.ref('staff/' + session.user).on('value', s => { 
                document.getElementById('myHours').innerText = (s.val()?.hours || "0.00") + "h"; 
            });
            
            db.ref('inventory').on('value', s => {
                let h = '';
                s.forEach(i => h += `<div class="glass p-4 rounded-2xl border-l-4 border-blue-500 text-[10px]"><p class="font-black truncate">${i.val().n}</p><p class="text-[8px] text-slate-500 mt-2">Log by ${i.val().by}</p></div>`);
                document.getElementById('invList').innerHTML = h;
            });
        }

        function loadAdminData() {
            db.ref('staff').on('value', s => {
                let h = '';
                s.forEach(u => {
                    h += `<div class="flex justify-between p-2 bg-white/5 rounded text-[10px] border border-white/5"><span><b>${u.key}</b> (${u.val().hours}h)</span><button onclick="if(confirm('Obri≈°i?')) db.ref('staff/${u.key}').remove()" class="text-red-500 font-black">X</button></div>`;
                });
                document.getElementById('adminStaffList').innerHTML = h;
            });
        }

        function createStaff() {
            const u = document.getElementById('adU').value.trim();
            const p = document.getElementById('adP').value.trim();
            if(u && p) { db.ref('staff/'+u).set({ pass: p, role: 'Radnik', hours: 0 }); alert("Dodan!"); }
        }

        function saveInfo() {
            const txt = document.getElementById('infoEditor').value;
            db.ref('globalInfo').set(txt);
            sendDiscord(WH.INFO, `üì¢ **NOVA OBAVIJEST UPRAVE**\n----------------------------\n${txt}`);
            alert("Objavljeno!");
        }

        function deleteInfo() {
            if(confirm("Obri≈°i globalnu obavijest?")) {
                db.ref('globalInfo').remove();
                sendDiscord(WH.INFO, `üóëÔ∏è **Obavijest je uklonjena od strane Admina.**`);
            }
        }

        function addInv() {
            const n = document.getElementById('invN').value;
            if(!n) return;
            db.ref('inventory').push({ n, by: session.user });
            sendDiscord(WH.EQUIP, `üì¶ **NOVA OPREMA/LOG**\nPredmet: **${n}**\nZapisao: **${session.user}**`);
            document.getElementById('invN').value = '';
        }

        function sendApp() {
            const p = document.getElementById('apPos').value;
            const t = document.getElementById('apTxt').value;
            if(!p || !t) return;
            sendDiscord(WH.APPLY, `üìÑ **NOVA PRIJAVA ZA POSAO**\nKorisnik: **${session.user}**\nPozicija: **${p}**\nOpis: ${t}`);
            alert("Prijava poslana!");
            document.getElementById('apPos').value = ''; document.getElementById('apTxt').value = '';
        }

        function sendDiscord(url, msg) {
            fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ content: msg }) }).catch(e => console.log("Discord error"));
        }
    </script>
</body>
</html>
