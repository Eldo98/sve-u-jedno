<!DOCTYPE html>
<html lang="hr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOU Enterprise v6.0</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --discord-blurple: #5865F2; --discord-dark: #313338; --discord-black: #1e1f22; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--discord-black); color: #f2f3f5; }
        .glass-card { background: var(--discord-dark); border: 1px solid rgba(255,255,255,0.08); border-radius: 16px; }
        .nav-btn { transition: 0.3s; font-weight: 800; text-transform: uppercase; border-radius: 12px; font-size: 0.75rem; }
        .nav-btn.active { background: var(--discord-blurple); box-shadow: 0 0 15px rgba(88,101,242,0.4); }
        input, select, textarea { background: #111214 !important; border: 1px solid #3f4147 !important; color: white !important; outline: none; }
        .strike-dot { height: 10px; width: 10px; border-radius: 50%; display: inline-block; background: #444; margin-left: 3px; }
        .strike-active { background: #f23f42; box-shadow: 0 0 8px #f23f42; }
    </style>
</head>
<body class="p-4 md:p-6">

<div class="max-w-5xl mx-auto">
    <header class="text-center mb-8">
        <h1 class="text-4xl font-black italic uppercase">NOU <span class="text-[#5865F2]">Enterprise</span></h1>
        <p class="text-[10px] text-gray-500 font-bold uppercase tracking-widest">Sustav v6.0 - Fixed Routing</p>
    </header>

    <div class="glass-card p-4 mb-6 flex flex-col md:flex-row items-center gap-4">
        <input type="text" id="globalUser" placeholder="Tvoj Discord (Ime#0000)" oninput="syncUser()" class="flex-1 w-full p-3 rounded-xl font-bold">
        <div id="userStats" class="hidden flex items-center gap-6 bg-black/30 p-3 rounded-xl px-6">
            <div class="text-center"><p class="text-[9px] text-gray-500 uppercase font-black">Sati</p><p id="statHours" class="text-lg font-black text-blue-400">0h</p></div>
            <div class="text-center border-l border-white/10 pl-6"><p class="text-[9px] text-gray-500 uppercase font-black">Strikes</p><div id="statStrikes" class="flex mt-1"></div></div>
        </div>
    </div>

    <nav class="flex gap-2 overflow-x-auto pb-4 mb-6">
        <button class="nav-btn active px-6 py-3" onclick="showTab('work')">‚è± Rad</button>
        <button class="nav-btn px-6 py-3" onclick="showTab('chat')">üí¨ Chat</button>
        <button class="nav-btn px-6 py-3" onclick="showTab('inventory')">üì¶ Oprema</button>
        <button class="nav-btn px-6 py-3" onclick="showTab('apply')">üìù Prijava</button>
        <button class="nav-btn px-6 py-3 text-yellow-500" onclick="showTab('admin')">üîí Admin</button>
    </nav>

    <main>
        <section id="workTab" class="tab-content">
            <div class="glass-card p-10 text-center mb-6">
                <div class="flex flex-col md:flex-row gap-4 justify-center">
                    <button onclick="clockIn()" class="bg-green-600 hover:bg-green-500 px-10 py-4 rounded-2xl font-black text-lg">START RAD</button>
                    <button onclick="clockOut()" class="bg-red-600 hover:bg-red-500 px-10 py-4 rounded-2xl font-black text-lg">STOP RAD</button>
                </div>
                <div id="workStatus" class="mt-4 text-xs font-bold text-gray-500 uppercase tracking-widest italic">Status: Offline</div>
            </div>
            <div class="glass-card p-4"><table class="w-full text-left"><tbody id="activeBody" class="divide-y divide-white/5"></tbody></table></div>
        </section>

        <section id="chatTab" class="tab-content hidden">
            <div class="glass-card p-4 h-[500px] flex flex-col">
                <div id="chatBox" class="flex-1 overflow-y-auto space-y-3 p-2"></div>
                <div class="mt-4 flex gap-2">
                    <input type="text" id="chatInput" placeholder="Poruka timu..." class="flex-1 p-3 rounded-xl" onkeypress="if(event.key==='Enter') sendChat()">
                    <button onclick="sendChat()" class="bg-[#5865F2] px-6 rounded-xl font-black uppercase">≈†alji</button>
                </div>
            </div>
        </section>

        <section id="inventoryTab" class="tab-content hidden space-y-4">
            <div class="glass-card p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="text" id="invNaziv" placeholder="Naziv" class="p-3 rounded-xl">
                    <input type="text" id="invModel" placeholder="Model" class="p-3 rounded-xl">
                    <select id="invKat" class="p-3 rounded-xl"><option>Laptop</option><option>Monitor</option><option>Server</option></select>
                    <input type="text" id="invSN" placeholder="S/N" class="p-3 rounded-xl">
                </div>
                <button onclick="addInventory()" class="w-full mt-4 bg-blue-600 py-3 rounded-xl font-black uppercase">Spremi i javi u kanal</button>
            </div>
            <div id="invList" class="grid grid-cols-1 md:grid-cols-3 gap-4 pb-10"></div>
        </section>

        <section id="applyTab" class="tab-content hidden">
            <div class="glass-card p-8 max-w-2xl mx-auto border-t-4 border-green-500">
                <h2 class="text-2xl font-black mb-4 uppercase">Prijava za tim</h2>
                <select id="applyRole" class="w-full p-4 rounded-xl mb-4 font-bold"><option>Helper</option><option>Designer</option><option>Worker</option></select>
                <textarea id="applyReason" rows="4" class="w-full p-4 rounded-xl mb-4" placeholder="Tvoje iskustvo..."></textarea>
                <button onclick="submitApplication()" class="w-full bg-[#5865F2] py-4 rounded-xl font-black uppercase">Po≈°alji prijavu</button>
            </div>
        </section>

        <section id="adminTab" class="tab-content hidden space-y-6">
            <div id="adminAuth" class="glass-card p-10 text-center max-w-sm mx-auto">
                <input type="password" id="adminPass" placeholder="Admin Lozinka" class="w-full p-4 rounded-xl mb-4 text-center font-black">
                <button onclick="checkAdmin()" class="w-full bg-white text-black py-3 rounded-xl font-black uppercase">Ulaz</button>
            </div>
            <div id="adminPanel" class="hidden space-y-6">
                <div class="glass-card p-6 border-l-4 border-yellow-500">
                    <h3 class="text-yellow-500 font-black text-xs uppercase mb-4">Slu≈æbene Obavijesti & Slike</h3>
                    <input type="text" id="annTitle" placeholder="Naslov" class="w-full p-3 rounded-lg mb-3 font-bold">
                    <textarea id="annMsg" rows="3" placeholder="Sadr≈æaj..." class="w-full p-3 rounded-lg mb-3"></textarea>
                    <input type="text" id="annImg" placeholder="Link slike (URL)" class="w-full p-3 rounded-lg text-xs mb-3">
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="sendOfficial('ann')" class="bg-yellow-600 py-3 rounded-xl font-black uppercase text-xs">OBAVIJEST</button>
                        <button onclick="sendOfficial('alert')" class="bg-red-600 py-3 rounded-xl font-black uppercase text-xs">HITNO (ALERT)</button>
                    </div>
                </div>
                <div class="glass-card p-6 border-l-4 border-red-600">
                    <h3 class="text-red-500 font-black text-xs uppercase mb-4">Strike Upravljanje</h3>
                    <input type="text" id="strikeTarget" placeholder="Ime#0000" class="w-full p-3 rounded-lg mb-3">
                    <div class="grid grid-cols-3 gap-2">
                        <button onclick="setStrike(1)" class="bg-red-900 py-2 rounded-lg font-black">S1</button>
                        <button onclick="setStrike(2)" class="bg-red-700 py-2 rounded-lg font-black">S2</button>
                        <button onclick="setStrike(3)" class="bg-red-500 py-2 rounded-lg font-black">S3</button>
                    </div>
                    <button onclick="resetStrike()" class="w-full bg-gray-700 py-2 rounded-lg mt-3 text-[10px] font-black uppercase">Reset Kazni</button>
                </div>
            </div>
        </section>
    </main>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyAoPo3Dj5yoH4sQeTScWZCe-jDDpkDPMt8",
        authDomain: "nou-management.firebaseapp.com",
        databaseURL: "https://nou-management-default-rtdb.firebaseio.com",
        projectId: "nou-management",
        storageBucket: "nou-management.firebasestorage.app",
        messagingSenderId: "1098791447574",
        appId: "1:1098791447574:web:6e4c666d302055658c9937"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const ADMIN_PW = "mihatovici_79";

    const getU = () => document.getElementById('globalUser').value.trim();
    const sanitize = (n) => n.replace(/[.#$/[\]]/g, '_');

    function showTab(id) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id + 'Tab').classList.remove('hidden');
        event.currentTarget.classList.add('active');
    }

    function syncUser() {
        const u = getU();
        if(!u) { document.getElementById('userStats').classList.add('hidden'); return; }
        db.ref('users/' + sanitize(u)).on('value', s => {
            const d = s.val() || {};
            document.getElementById('userStats').classList.remove('hidden');
            document.getElementById('statHours').innerText = `${d.hours || '0.00'}h`;
            let dots = '';
            for(let i=1; i<=3; i++) dots += `<span class="strike-dot ${i <= (d.strikes || 0) ? 'strike-active' : ''}"></span>`;
            document.getElementById('statStrikes').innerHTML = dots;
        });
    }

    // 1. KANAL: POƒåETAK I KRAJ RADA
    function clockIn() {
        if(!getU()) return alert("Ime!");
        db.ref('users/' + sanitize(getU())).update({ status: 'Online', lastIn: Date.now() });
        fetch("https://discord.com/api/webhooks/1463866279860633672/CqGRQKkkBYlZkC76HqUZBaHbBuJvjmCEYkF7mZD7zrORhi7KdNA9vhBV_DRL_uTVBTZO", { 
            method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({content: `üöÄ **${getU()}** je zapoƒçeo rad.`}) 
        });
        document.getElementById('workStatus').innerText = "Status: Online";
    }

    function clockOut() {
        const id = sanitize(getU());
        db.ref('users/' + id).once('value', s => {
            const d = s.val(); if(!d || !d.lastIn) return;
            const diff = ((Date.now() - d.lastIn) / 3600000).toFixed(2);
            const total = (parseFloat(d.hours || 0) + parseFloat(diff)).toFixed(2);
            db.ref('users/' + id).update({ status: 'Offline', hours: total, lastIn: null });
            fetch("https://discord.com/api/webhooks/1463866279860633672/CqGRQKkkBYlZkC76HqUZBaHbBuJvjmCEYkF7mZD7zrORhi7KdNA9vhBV_DRL_uTVBTZO", { 
                method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({content: `‚èπ **${getU()}** je zavr≈°io rad. Radio: **${diff}h**.`}) 
            });
            document.getElementById('workStatus').innerText = "Status: Offline";
        });
    }

    // 2. KANAL: PRIJAVE
    function submitApplication() {
        if(!getU()) return alert("Ime!");
        const data = {
            embeds: [{
                title: "üì© Nova Prijava za NOU",
                color: 5814783,
                fields: [
                    {name: "üë§ Korisnik", value: getU(), inline: true},
                    {name: "üé≠ Pozicija", value: document.getElementById('applyRole').value, inline: true},
                    {name: "üìù Razlog", value: document.getElementById('applyReason').value}
                ],
                timestamp: new Date()
            }]
        };
        fetch("https://discord.com/api/webhooks/1463803834454245406/_UVJ8jv6baedZuYr25uT8S4jPgUkX_KiQtvzTgNpdDRbuHt90K-0-nvHNFURRUxzQmK6", { 
            method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data) 
        });
        alert("Prijava poslana!");
    }

    // 3. KANAL: OPREMA
    function addInventory() {
        const n = document.getElementById('invNaziv').value;
        if(!n) return;
        db.ref('inventar').push({ naziv: n, model: document.getElementById('invModel').value, kat: document.getElementById('invKat').value, sn: document.getElementById('invSN').value });
        
        const data = {
            embeds: [{
                title: "üì¶ Nova Oprema Dodana",
                color: 3447003,
                fields: [
                    {name: "Ureƒëaj", value: n, inline: true},
                    {name: "Model", value: document.getElementById('invModel').value, inline: true},
                    {name: "S/N", value: document.getElementById('invSN').value, inline: true}
                ],
                timestamp: new Date()
            }]
        };
        fetch("https://discord.com/api/webhooks/1463955268525228198/84s4OI9mWtiWY17TMqHN2VJ-GUqgzT2-vpIJsYx3-zC-lPFgGdAy73HkvvZZjdCX7nQF", { 
            method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data) 
        });
        alert("Oprema spremljena!");
    }

    // 4. KANAL: ADMIN OBAVIJESTI I STRIKE
    function sendOfficial(type) {
        const title = document.getElementById('annTitle').value;
        const msg = document.getElementById('annMsg').value;
        const img = document.getElementById('annImg').value;
        if(!title || !msg) return;

        const embed = {
            embeds: [{
                title: (type === 'alert' ? "üö® HITNO: " : "üì¢ OBAVIJEST: ") + title,
                description: msg,
                color: type === 'alert' ? 15206400 : 16763904,
                image: img ? { url: img } : null,
                timestamp: new Date()
            }]
        };
        fetch("https://discord.com/api/webhooks/1463869887498817536/gRHBl-FjoQ0hFZhJ3k6qbAkk4adLI-EAPuO94ncVd-8tSd-6LW8AOsxOGnfwJIYVlNNR", { 
            method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(embed) 
        });
        alert("Admin obavijest poslana!");
    }

    function setStrike(n) {
        const t = document.getElementById('strikeTarget').value.trim();
        if(!t) return alert("Ime!");
        db.ref('users/' + sanitize(t)).update({ strikes: n });
        fetch("https://discord.com/api/webhooks/1463869887498817536/gRHBl-FjoQ0hFZhJ3k6qbAkk4adLI-EAPuO94ncVd-8tSd-6LW8AOsxOGnfwJIYVlNNR", { 
            method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({content: `‚ö†Ô∏è **STRIKE ${n}/3** dodijeljen radniku **${t}**!`}) 
        });
        alert("Strike poslan!");
    }

    function resetStrike() {
        const t = document.getElementById('strikeTarget').value.trim();
        if(!t) return;
        db.ref('users/' + sanitize(t)).update({ strikes: 0 });
        fetch("https://discord.com/api/webhooks/1463869887498817536/gRHBl-FjoQ0hFZhJ3k6qbAkk4adLI-EAPuO94ncVd-8tSd-6LW8AOsxOGnfwJIYVlNNR", { 
            method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({content: `‚úÖ Resetirani strikeovi za **${t}**.`}) 
        });
    }

    // OSTALO
    function checkAdmin() {
        if(document.getElementById('adminPass').value === ADMIN_PW) {
            document.getElementById('adminAuth').classList.add('hidden');
            document.getElementById('adminPanel').classList.remove('hidden');
        } else alert("Pogre≈°na ≈°ifra!");
    }

    function sendChat() {
        const t = document.getElementById('chatInput').value;
        if(!t || !getU()) return;
        db.ref('chat').push({ u: getU(), t: t });
        document.getElementById('chatInput').value = "";
    }

    db.ref('chat').limitToLast(15).on('value', s => {
        let h = ''; s.forEach(c => { h += `<div class="bg-black/20 p-3 rounded-xl"><p class="text-[9px] text-blue-400 font-black uppercase">${c.val().u}</p><p class="text-sm">${c.val().t}</p></div>`; });
        const b = document.getElementById('chatBox'); b.innerHTML = h; b.scrollTop = b.scrollHeight;
    });

    db.ref('inventar').on('value', s => {
        let h = ''; s.forEach(c => { const i = c.val(); h += `<div class="glass-card p-4"><h4 class="font-black">${i.naziv}</h4><p class="text-[10px] text-blue-400 uppercase">${i.kat} | ${i.sn}</p></div>`; });
        document.getElementById('invList').innerHTML = h;
    });

    db.ref('users').on('value', s => {
        let h = ''; s.forEach(c => {
            const u = c.val(); let dots = ''; for(let i=1; i<=3; i++) dots += `<span class="strike-dot ${i <= (u.strikes || 0) ? 'strike-active' : ''}"></span>`;
            h += `<tr><td class="py-4 font-black">${c.key}</td><td><span class="${u.status === 'Online' ? 'text-green-500' : 'text-gray-600'} text-[10px] font-black uppercase">${u.status || 'Offline'}</span></td><td class="text-right">${dots}</td></tr>`;
        });
        document.getElementById('activeBody').innerHTML = h;
    });
</script>
</body>
</html>